<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ğŸ‘‘ ÙÙ„Ø§ÙÙ„ ÙˆØ·Ø¹Ù…ÙŠØ© Ø§Ù„Ø¨ÙŠÙƒ - Ø§Ù„Ø­ÙˆØ¨Ø§Ù†</title>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        /* ØªØ¹Ø±ÙŠÙ Ø§Ù„Ø£Ù„ÙˆØ§Ù† Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© */
        :root {
            --primary: #D32F2F; 
            --secondary: #FFC107; 
            --bg: #F4F6F8;
            --card-bg: white;
            --text: #2c3e50;
            --text-light: #777;
            --green: #2ecc71;
            --kurimi: #00695c;
            --shadow-color: rgba(0,0,0,0.05);
            --border-color: #eee;
        }

        /* Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ø¯Ø§ÙƒÙ† (Dark Mode) */
        body.dark-mode {
            --bg: #121212;
            --card-bg: #1e1e1e;
            --text: #e0e0e0;
            --text-light: #aaaaaa;
            --shadow-color: rgba(255,255,255,0.05);
            --border-color: #333333;
        }

        /* ØªÙ†Ø³ÙŠÙ‚Ø§Øª Ø¹Ø§Ù…Ø© */
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body {
            font-family: 'Tajawal', sans-serif;
            background-color: var(--bg);
            margin: 0; padding-bottom: 160px; color: var(--text);
            transition: background-color 0.3s, color 0.3s;
        }

        /* Ø§Ù„Ù‡ÙŠØ¯Ø± */
        header {
            background: var(--card-bg);
            padding: 15px;
            text-align: center;
            box-shadow: 0 4px 15px var(--shadow-color);
            position: sticky; top: 0; z-index: 1000;
            border-bottom: 4px solid var(--primary);
            transition: background-color 0.3s;
        }
        .logo-area img {
            width: 100px; height: 100px; border-radius: 50%;
            border: 3px solid var(--secondary);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            object-fit: cover;
        }
        h1 { margin: 10px 0 5px; font-size: 1.3rem; color: var(--primary); font-weight: 900; }
        .location-badge { font-size: 0.8rem; color: var(--text-light); margin-bottom: 5px; }
        
        .status-badge {
            padding: 5px 15px; border-radius: 20px;
            font-size: 0.85rem; font-weight: bold;
            display: inline-block;
        }
        .open { background: #e8f5e9; color: #1b5e20; }
        .closed { background: #ffebee; color: #c62828; }

        /* Ø²Ø± Ø§Ù„ØªØ¨Ø¯ÙŠÙ„ Ø¨ÙŠÙ† Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„ÙØ§ØªØ­ ÙˆØ§Ù„Ø¯Ø§ÙƒÙ† */
        #theme-toggle {
            position: absolute;
            top: 20px;
            left: 20px;
            width: 40px;
            height: 40px;
            background: var(--border-color);
            border: 1px solid var(--border-color);
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            color: var(--text);
            transition: background 0.3s, color 0.3s;
        }
        body.dark-mode #theme-toggle {
            background: #444;
            color: #FFC107;
            border-color: #555;
        }


        /* Ø§Ù„ØªØµÙ†ÙŠÙØ§Øª */
        .nav-scroller {
            display: flex; gap: 10px; overflow-x: auto;
            padding: 15px; scrollbar-width: none;
            background: var(--bg);
        }
        .nav-item {
            background: var(--card-bg); border: 1px solid var(--border-color);
            padding: 10px 20px; border-radius: 25px;
            white-space: nowrap; cursor: pointer;
            transition: 0.3s; font-weight: bold;
            color: var(--text);
        }
        .nav-item.active {
            background: var(--primary); color: white;
            border-color: var(--primary); transform: scale(1.05);
        }

        /* Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© */
        .menu-grid { padding: 10px; display: grid; gap: 15px; }
        .menu-item {
            background: var(--card-bg); border-radius: 15px;
            padding: 10px; display: flex; align-items: center;
            box-shadow: 0 3px 10px var(--shadow-color);
            transition: background-color 0.3s;
        }
        .menu-item img {
            width: 90px; height: 90px; border-radius: 12px;
            object-fit: cover; margin-left: 15px;
            background-color: var(--border-color);
        }
        .item-info { flex: 1; }
        .item-info h3 { margin: 0 0 5px; font-size: 1rem; color: var(--text); }
        .item-desc { font-size: 0.75rem; color: var(--text-light); margin-bottom: 5px; }
        .price { color: var(--primary); font-weight: bold; font-size: 1.1rem; }
        
        /* Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªØ­ÙƒÙ… */
        .controls {
            display: flex; align-items: center;
            background: var(--border-color); border-radius: 20px; padding: 2px;
        }
        .btn-qty {
            width: 35px; height: 35px; border: none;
            background: var(--card-bg); border-radius: 50%;
            font-size: 1.2rem; color: var(--primary);
            box-shadow: 0 2px 5px var(--shadow-color);
            cursor: pointer;
        }
        .qty-val { width: 30px; text-align: center; font-weight: bold; color: var(--text); }

        /* Ø´Ø±ÙŠØ· Ø§Ù„Ø³Ù„Ø© */
        .cart-bar {
            position: fixed; bottom: 0; left: 0; right: 0;
            background: var(--card-bg); padding: 15px;
            border-radius: 20px 20px 0 0;
            box-shadow: 0 -5px 20px var(--shadow-color);
            z-index: 2000;
            transition: background-color 0.3s;
        }
        
        .delivery-panel {
            background: var(--bg); border: 1px solid var(--border-color);
            padding: 10px; border-radius: 10px;
            margin-bottom: 10px; font-size: 0.85rem;
            display: flex; justify-content: space-between; align-items: center;
            color: var(--text);
        }
        .delivery-btn {
            background: var(--primary); color: white;
            border: none; padding: 6px 15px; border-radius: 8px;
            cursor: pointer; font-size: 0.8rem;
        }

        .total-row {
            display: flex; justify-content: space-between; align-items: center;
            margin-bottom: 10px; font-weight: bold; font-size: 1.1rem;
            color: var(--text);
        }
        .action-btn {
            width: 100%; padding: 14px; border: none;
            border-radius: 12px; background: #25D366;
            color: white; font-size: 1.1rem; font-weight: bold;
            display: flex; justify-content: center; align-items: center; gap: 8px;
            cursor: pointer; transition: 0.3s;
        }
        .action-btn:disabled { background: #ccc; }

        /* Ø§Ù„Ù†ÙˆØ§ÙØ° Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø© */
        .modal-box {
            background: var(--card-bg); 
            transition: background-color 0.3s;
        }
        .input-field {
            background: var(--bg); 
            color: var(--text);
            border: 1px solid var(--border-color);
        }
        .pay-opt {
            border: 2px solid var(--border-color); 
        }
        .pay-opt.selected { border-color: var(--kurimi); background: var(--bg); }
        
        /* Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ…Ø±ÙŠØ± */
        .nav-scroller::-webkit-scrollbar { display: none; }
        .nav-scroller { -ms-overflow-style: none; /* IE and Edge */ }
        
        /* Ø¨Ø§Ù‚ÙŠ Ø§Ù„ØªÙ†Ø³ÙŠÙ‚Ø§Øª ÙÙŠ Ø§Ù„ÙƒÙˆØ¯ */
    </style>
</head>
<body>

    <header>
        <button id="theme-toggle">â˜€ï¸</button>
        
        <div class="logo-area">
            <img src="images/logo.jpg.png" onerror="this.src='https://cdn-icons-png.flaticon.com/512/1046/1046751.png'" alt="ÙÙ„Ø§ÙÙ„ Ø§Ù„Ø¨ÙŠÙƒ">
        </div>
        <h1>ÙÙ„Ø§ÙÙ„ ÙˆØ·Ø¹Ù…ÙŠØ© Ø§Ù„Ø¨ÙŠÙƒ ğŸ‘‘</h1>
        <div class="location-badge">ğŸ“ ØªØ¹Ø² - Ø§Ù„Ø­ÙˆØ¨Ø§Ù†</div>
        <div id="store-status" class="status-badge open">ğŸŸ¢ Ù…ÙØªÙˆØ­ - Ù†Ø³ØªÙ‚Ø¨Ù„ Ø§Ù„Ø·Ù„Ø¨Ø§Øª</div>
    </header>

    <div class="nav-scroller">
        <button class="nav-item active" onclick="filter('all', this)">Ø§Ù„ÙƒÙ„</button>
        <button class="nav-item" onclick="filter('Ø³Ù†Ø¯ÙˆØªØ´Ø§Øª', this)">Ø³Ù†Ø¯ÙˆØªØ´Ø§Øª ğŸŒ¯</button>
        <button class="nav-item" onclick="filter('ÙˆØ¬Ø¨Ø§Øª', this)">ÙˆØ¬Ø¨Ø§Øª ğŸŸ</button>
        <button class="nav-item" onclick="filter('Ù…Ø´Ø±ÙˆØ¨Ø§Øª', this)">Ù…Ø´Ø±ÙˆØ¨Ø§Øª ğŸ¥¤</button>
    </div>

    <div id="menu-list" class="menu-grid"></div>

    <div class="cart-bar">
        <div class="delivery-panel" id="delivery-panel">
            <span id="delivery-text">ğŸ“ Ø­Ø¯Ø¯ Ù…ÙˆÙ‚Ø¹Ùƒ (Ø§Ù„ØªÙˆØµÙŠÙ„ Ù„Ù„Ø­ÙˆØ¨Ø§Ù† ÙÙ‚Ø·)</span>
            <button class="delivery-btn" onclick="calculateDelivery()">Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø³Ø§ÙØ©</button>
        </div>

        <div class="total-row">
            <span>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ:</span>
            <span id="grand-total" style="color:var(--primary)">0 Ø±ÙŠØ§Ù„</span>
        </div>

        <button id="main-btn" class="action-btn" onclick="openCustomerModal()" disabled>
            Ø³Ù„Ø© ÙØ§Ø±ØºØ© ğŸ›’
        </button>
    </div>

    <div id="customer-modal" class="modal">
        <div class="modal-box">
            <h3>ğŸ“ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ù„Ø¨</h3>
            
            <div class="input-group">
                <label>Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹:</label>
                <div class="payment-options">
                    <div class="pay-opt selected" onclick="selectPayment('ÙƒØ§Ø´', this)">
                        <span>ğŸ’µ</span><br>ÙƒØ§Ø´
                    </div>
                    <div class="pay-opt" onclick="selectPayment('Ø­Ø§Ø³Ø¨ (ÙƒØ±ÙŠÙ…ÙŠ)', this)">
                        <span class="kurimi-badge">Kurimi</span>
                        Ø­Ø§Ø³Ø¨
                    </div>
                </div>
            </div>

            <div class="input-group">
                <label>Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ±ÙŠÙ…:</label>
                <input type="text" id="cust-name" class="input-field" placeholder="Ø§Ù„Ø§Ø³Ù…..">
            </div>
            
            <div class="input-group">
                <label>Ø±Ù‚Ù… Ø§Ù„Ø¬ÙˆØ§Ù„ (ÙˆØ§ØªØ³Ø§Ø¨):</label>
                <input type="tel" id="cust-phone" class="input-field" placeholder="7xxxxxxxx" maxlength="9">
            </div>
            
            <div class="input-group">
                <label>Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ©:</label>
                <input type="text" id="cust-notes" class="input-field" placeholder="Ø¨Ø¯ÙˆÙ† Ø´Ø·Ø©ØŒ ÙƒØ«Ø± Ø·Ø­ÙŠÙ†Ø©...">
            </div>

            <button class="action-btn" onclick="sendToWhatsapp()">ØªØ£ÙƒÙŠØ¯ ÙˆØ¥Ø±Ø³Ø§Ù„ ğŸš€</button>
            <button onclick="document.getElementById('customer-modal').style.display='none'" style="margin-top:10px; background:none; border:none; color:var(--text-light); cursor:pointer;">Ø¥Ù„ØºØ§Ø¡</button>
        </div>
    </div>

<script>
    // ==========================================
    // âš™ï¸ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…ØªØ¬Ø± (Ø§Ù„Ø­ÙˆØ¨Ø§Ù†)
    // ==========================================
    
    const HAWBAN_LAT = 13.6180; 
    const HAWBAN_LNG = 44.0680; 
    const MAX_DELIVERY_RANGE = 7.0; // ÙƒÙ…
    const PRICE_PER_KM = 300; // Ø±ÙŠØ§Ù„
    const MIN_DELIVERY = 500; // Ø±ÙŠØ§Ù„
    const WHATSAPP_NUMBER = "967733971941";

    const menu = [
        // Ø§Ù„Ø³Ù†Ø¯ÙˆØªØ´Ø§Øª
        { 
            id: 1, 
            name: "Ø³Ø§Ù†Ø¯ÙˆÙŠØªØ´ ÙÙ„Ø§ÙÙ„ (Ø·Ø¹Ù…ÙŠØ©)", 
            price: 100,
            cat: "Ø³Ù†Ø¯ÙˆØªØ´Ø§Øª", 
            desc: "Ø·Ø¹Ù…ÙŠØ© Ù…Ù‚Ø±Ù…Ø´Ø© Ù…Ø¹ Ø³Ù„Ø·Ø©", 
            img: "falafel.jpg" // **ØªÙ… Ø§Ù„ØªØµØ­ÙŠØ­ Ù„ÙŠÙ†Ø§Ø³Ø¨ "falafel.jpg" Ù„Ø¯ÙŠÙƒ**
        },
        { 
            id: 2, 
            name: "Ø³Ø§Ù†Ø¯ÙˆÙŠØªØ´ ÙÙ„Ø§ÙÙ„ Ù…Ø¹ Ø§Ù„Ø¨ÙŠØ¶", 
            price: 150,
            cat: "Ø³Ù†Ø¯ÙˆØªØ´Ø§Øª", 
            desc: "ÙÙ„Ø§ÙÙ„ Ù…Ù…ÙŠØ²Ø© Ù…Ø¹ Ø§Ù„Ø¨ÙŠØ¶ Ø§Ù„Ù…Ø³Ù„ÙˆÙ‚",
            img: "falafel_egg.jpg.png" // **Ù„ÙŠÙ†Ø§Ø³Ø¨ "falafel_egg.jpg.png" Ù„Ø¯ÙŠÙƒ**
        },
        
        // Ø§Ù„ÙˆØ¬Ø¨Ø§Øª
        { 
            id: 3, 
            name: "ÙˆØ¬Ø¨Ø© Ù…Ø§ÙƒØ³ Ø§Ù„Ù…Ù„ÙƒÙŠ (ÙÙ„Ø§ÙÙ„ ÙˆØ¨Ø·Ø§Ø·Ø³)", 
            price: 500,
            cat: "ÙˆØ¬Ø¨Ø§Øª", 
            desc: "ØªØ´ÙƒÙŠÙ„Ø© Ù…Ø´Ø¨Ø¹Ø© Ù…Ù† Ø§Ù„ÙÙ„Ø§ÙÙ„ ÙˆØ§Ù„Ø¨Ø·Ø§Ø·Ø³",
            img: "meal.jpg" // **Ù„ÙŠÙ†Ø§Ø³Ø¨ "meal.jpg" Ù„Ø¯ÙŠÙƒ**
        },
        { 
            id: 4, 
            name: "ØµØ­Ù† Ø¨Ø·Ø§Ø·Ø³ Ù…Ù‚Ø±Ù…Ø´Ø©", 
            price: 400,
            cat: "ÙˆØ¬Ø¨Ø§Øª", 
            desc: "Ø¨Ø·Ø§Ø·Ø³ Ù…Ù‚Ù„ÙŠØ© Ø°Ù‡Ø¨ÙŠØ© ÙˆÙ…Ù‚Ø±Ù…Ø´Ø©",
            img: "fries.jpg" 
        },

        // Ø§Ù„Ù…Ø´Ø±ÙˆØ¨Ø§Øª
        { 
            id: 5, 
            name: "Ø³ÙÙ† Ø£Ø¨", 
            price: 200,
            cat: "Ù…Ø´Ø±ÙˆØ¨Ø§Øª", 
            desc: "Ù…Ø´Ø±ÙˆØ¨ ØºØ§Ø²ÙŠ Ù…Ù†Ø¹Ø´",
            img: "7up.png" // **Ù„ÙŠÙ†Ø§Ø³Ø¨ "7up.png" Ù„Ø¯ÙŠÙƒ**
        },
        { 
            id: 6, 
            name: "Ù…Ø´Ø±ÙˆØ¨ Ø´Ø±ÙˆÙ„Ùƒ Ø£Ø³Ø¯ Ø¨Ø§Ø±Ø¯", 
            price: 100,
            cat: "Ù…Ø´Ø±ÙˆØ¨Ø§Øª", 
            desc: "Ù…Ø´Ø±ÙˆØ¨ Ø·Ø§Ù‚Ø©",
            img: "energy.png" // **Ù„ÙŠÙ†Ø§Ø³Ø¨ "energy.png" Ù„Ø¯ÙŠÙƒ**
        },
    ];

    // ==========================================
    // ğŸ§  Ø§Ù„Ù…Ù†Ø·Ù‚ Ø§Ù„Ø¨Ø±Ù…Ø¬ÙŠ
    // ==========================================
    
    let cart = {};
    let deliveryCost = 0;
    let userLocation = null;
    let selectedPayment = 'ÙƒØ§Ø´';

    // ğŸ’¡ ÙˆØ¸ÙŠÙØ© Ø¬Ø¯ÙŠØ¯Ø©: Ø­ÙØ¸ ÙˆØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„ÙØ§ØªØ­/Ø§Ù„Ø¯Ø§ÙƒÙ†
    function initializeTheme() {
        const savedTheme = localStorage.getItem('theme');
        if (savedTheme === 'dark') {
            document.body.classList.add('dark-mode');
            document.getElementById('theme-toggle').textContent = 'ğŸŒ™'; // Ù‚Ù…Ø± Ù„Ù„ÙˆØ¶Ø¹ Ø§Ù„Ø¯Ø§ÙƒÙ†
        } else {
            document.getElementById('theme-toggle').textContent = 'â˜€ï¸'; // Ø´Ù…Ø³ Ù„Ù„ÙˆØ¶Ø¹ Ø§Ù„ÙØ§ØªØ­
        }
    }

    // ğŸ’¡ ÙˆØ¸ÙŠÙØ© Ø¬Ø¯ÙŠØ¯Ø©: Ø§Ù„ØªØ¨Ø¯ÙŠÙ„ Ø¨ÙŠÙ† Ø§Ù„Ø£ÙˆØ¶Ø§Ø¹
    document.getElementById('theme-toggle').addEventListener('click', () => {
        document.body.classList.toggle('dark-mode');
        const isDarkMode = document.body.classList.contains('dark-mode');
        
        if (isDarkMode) {
            localStorage.setItem('theme', 'dark');
            document.getElementById('theme-toggle').textContent = 'ğŸŒ™';
        } else {
            localStorage.setItem('theme', 'light');
            document.getElementById('theme-toggle').textContent = 'â˜€ï¸';
        }
    });

    function checkStoreStatus() {
        const hour = new Date().getHours();
        const statusDiv = document.getElementById('store-status');
        const mainBtn = document.getElementById('main-btn'); 
        
        // Ø§Ù„Ù…ØªØ¬Ø± Ù…ØºÙ„Ù‚ Ù…Ù† 1 ØµØ¨Ø§Ø­Ø§Ù‹ Ø­ØªÙ‰ Ù‚Ø¨Ù„ 7 ØµØ¨Ø§Ø­Ø§Ù‹
        if (hour >= 1 && hour < 7) { 
            statusDiv.className = 'status-badge closed';
            statusDiv.innerHTML = 'ğŸ”´ Ø§Ù†ØªÙ‡Ù‰ Ø¯ÙˆØ§Ù… Ø§Ù„ØªÙˆØµÙŠÙ„ØŒ Ø²ÙˆØ±ÙˆÙ†Ø§ Ø¹Ù„Ù‰ Ù…ÙˆÙ‚Ø¹Ù†Ø§ (ÙŠÙØªØ­ 7 ØµØ¨Ø§Ø­Ø§Ù‹)'; 
            
            mainBtn.disabled = true; 
            mainBtn.innerText = "Ø§Ù†ØªÙ‡Ù‰ Ø¯ÙˆØ§Ù… Ø§Ù„ØªÙˆØµÙŠÙ„ ğŸ”’"; 
            mainBtn.onclick = null; 

        } else {
            statusDiv.className = 'status-badge open';
            statusDiv.innerHTML = 'ğŸŸ¢ Ù…ÙØªÙˆØ­ - Ù†Ø³ØªÙ‚Ø¨Ù„ Ø§Ù„Ø·Ù„Ø¨Ø§Øª';
            mainBtn.onclick = openCustomerModal; 
        }
    }

    function loadCart() {
        const saved = localStorage.getItem('bik_cart');
        if (saved) {
            cart = JSON.parse(saved);
            updateTotal();
        }
    }

    function renderMenu(category = 'all') {
        const container = document.getElementById('menu-list');
        container.innerHTML = '';
        
        menu.forEach(item => {
            if (category === 'all' || item.cat === category) {
                const qty = cart[item.id] || 0;
                // ØªÙ… ÙˆØ¶Ø¹ Ù…Ø³Ø§Ø± Ø§Ù„Ù…Ø¬Ù„Ø¯ (images/) Ù‡Ù†Ø§ Ù„ØªØ¬Ù†Ø¨ ØªÙƒØ±Ø§Ø±Ù‡ ÙÙŠ Ù…ØµÙÙˆÙØ© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
                const imgSrc = `images/${item.img}`;
                const fallbackImg = "https://cdn-icons-png.flaticon.com/512/706/706164.png";
                
                container.innerHTML += `
                <div class="menu-item">
                    <img src="${imgSrc}" onerror="this.src='${fallbackImg}'" onclick="updateQty(${item.id}, 1)">
                    <div class="item-info">
                        <h3>${item.name}</h3>
                        <div class="item-desc">${item.desc || ''}</div>
                        <div class="price">${item.price} Ø±ÙŠØ§Ù„</div>
                    </div>
                    <div class="controls">
                        <button class="btn-qty" onclick="updateQty(${item.id}, -1)">-</button>
                        <span class="qty-val">${qty}</span>
                        <button class="btn-qty" onclick="updateQty(${item.id}, 1)">+</button>
                    </div>
                </div>`;
            }
        });
    }

    window.updateQty = (id, change) => {
        if(navigator.vibrate) navigator.vibrate(30);
        if (!cart[id]) cart[id] = 0;
        cart[id] += change;
        if (cart[id] <= 0) delete cart[id];
        localStorage.setItem('bik_cart', JSON.stringify(cart));
        const currentCat = document.querySelector('.nav-item.active').innerText.split(' ')[0];
        renderMenu(currentCat === 'Ø§Ù„ÙƒÙ„' ? 'all' : currentCat);
        updateTotal();
    };

    function getDistance(lat1, lon1, lat2, lon2) {
        const R = 6371; 
        const dLat = (lat2 - lat1) * Math.PI / 180;
        const dLon = (lon2 - lon1) * Math.PI / 180;
        const a = Math.sin(dLat/2) * Math.sin(dLat/2) +
                  Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) * Math.sin(dLon/2) * Math.sin(dLon/2);
        const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
        return R * c; 
    }

    window.calculateDelivery = () => {
        const btn = document.querySelector('.delivery-btn');
        const txt = document.getElementById('delivery-text');
        
        btn.innerText = "Ø¬Ø§Ø±ÙŠ ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹...";
        
        if (!navigator.geolocation) return alert("Ø§Ù„Ù…ØªØµÙØ­ Ù„Ø§ ÙŠØ¯Ø¹Ù… Ø§Ù„Ø®Ø±Ø§Ø¦Ø·");

        navigator.geolocation.getCurrentPosition(
            (pos) => {
                userLocation = pos.coords;
                const dist = getDistance(HAWBAN_LAT, HAWBAN_LNG, userLocation.latitude, userLocation.longitude);
                
                if (dist > MAX_DELIVERY_RANGE) {
                    txt.innerHTML = `âŒ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø®Ø§Ø±Ø¬ Ù†Ø·Ø§Ù‚ Ø§Ù„ØªÙˆØµÙŠÙ„ (${dist.toFixed(1)} ÙƒÙ…)`;
                    txt.style.color = "red";
                    btn.innerText = "Ø£Ø¹Ø¯ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø©";
                    deliveryCost = 0;
                    alert("Ø¹Ø°Ø±Ø§Ù‹ØŒ Ø§Ù„ØªÙˆØµÙŠÙ„ Ù…ØªØ§Ø­ ÙÙ‚Ø· Ø¯Ø§Ø®Ù„ Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø­ÙˆØ¨Ø§Ù† ÙˆØ¶ÙˆØ§Ø­ÙŠÙ‡Ø§.");
                } else {
                    let cost = Math.ceil(dist * PRICE_PER_KM);
                    if(cost < MIN_DELIVERY) cost = MIN_DELIVERY;
                    cost = Math.ceil(cost / 50) * 50;
                    
                    deliveryCost = cost;
                    txt.innerHTML = `âœ… Ù…Ø³Ø§ÙØ©: ${dist.toFixed(1)} ÙƒÙ… | ØªÙˆØµÙŠÙ„: ${cost} Ø±ÙŠØ§Ù„`;
                    txt.style.color = "#1b5e20";
                    btn.style.display = 'none'; 
                    document.getElementById('delivery-panel').style.background = "#e8f5e9";
                }
                updateTotal();
            },
            (err) => {
                btn.innerText = "ØªÙØ¹ÙŠÙ„ GPS";
                alert("ÙŠØ¬Ø¨ Ø§Ù„Ø³Ù…Ø§Ø­ Ø¨ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ù„Ø­Ø³Ø§Ø¨ Ø³Ø¹Ø± Ø§Ù„ØªÙˆØµÙŠÙ„.");
            },
            { enableHighAccuracy: true }
        );
    };

    function updateTotal() {
        let foodTotal = 0;
        let count = 0;
        menu.forEach(item => {
            if(cart[item.id]) {
                foodTotal += cart[item.id] * item.price;
                count += cart[item.id];
            }
        });
        const grandTotal = foodTotal + deliveryCost;
        document.getElementById('grand-total').innerText = `${grandTotal} Ø±ÙŠØ§Ù„`;
        const btn = document.getElementById('main-btn');
        const hour = new Date().getHours();

        if (hour >= 1 && hour < 7) {
            btn.disabled = true;
            btn.innerHTML = "Ø§Ù†ØªÙ‡Ù‰ Ø¯ÙˆØ§Ù… Ø§Ù„ØªÙˆØµÙŠÙ„ ğŸ”’"; 
        } else if(count > 0) {
            btn.disabled = false;
            btn.innerHTML = `Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ø·Ù„Ø¨ (${grandTotal} Ø±ÙŠØ§Ù„)`;
        } else {
            btn.disabled = true;
            btn.innerHTML = `Ø³Ù„Ø© ÙØ§Ø±ØºØ© ğŸ›’`;
        }
    }

    window.selectPayment = (type, elem) => {
        selectedPayment = type;
        document.querySelectorAll('.pay-opt').forEach(el => el.classList.remove('selected'));
        elem.classList.add('selected');
    }

    window.openCustomerModal = () => {
        const hour = new Date().getHours();
        if (hour >= 1 && hour < 7) return; 

        if(!userLocation && confirm("Ù„Ù… ØªØ­Ø¯Ø¯ Ù…ÙˆÙ‚Ø¹Ùƒ Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„ØªÙˆØµÙŠÙ„ Ø¨Ø¯Ù‚Ø©ØŒ Ù‡Ù„ ØªØ±ÙŠØ¯ Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø©ØŸ")) {
             document.getElementById('customer-modal').style.display = 'flex';
        } else if (userLocation) {
            document.getElementById('customer-modal').style.display = 'flex';
        }
    }

    window.filter = (cat, btn) => {
        document.querySelectorAll('.nav-item').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        renderMenu(cat);
    }

    window.sendToWhatsapp = () => {
        const name = document.getElementById('cust-name').value;
        const phone = document.getElementById('cust-phone').value;
        const notes = document.getElementById('cust-notes').value;

        if(!name) return alert("Ø§Ù„Ø±Ø¬Ø§Ø¡ ÙƒØªØ§Ø¨Ø© Ø§Ù„Ø§Ø³Ù…");
        if(!phone || phone.length < 9) return alert("Ø§Ù„Ø±Ø¬Ø§Ø¡ ÙƒØªØ§Ø¨Ø© Ø±Ù‚Ù… Ù‡Ø§ØªÙ ØµØ­ÙŠØ­");

        let msg = `*Ø·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯ ğŸ¥™ - Ø§Ù„Ø¨ÙŠÙƒ (Ø§Ù„Ø­ÙˆØ¨Ø§Ù†)*\n`;
        msg += `ğŸ‘¤ *Ø§Ù„Ø§Ø³Ù…:* ${name}\nğŸ“± *Ø§Ù„Ø¬ÙˆØ§Ù„:* ${phone}\n`;
        msg += `ğŸ’³ *Ø§Ù„Ø¯ÙØ¹:* ${selectedPayment}\n`;
        msg += `------------------------\n`;
        
        let total = 0;
        menu.forEach(item => {
            if(cart[item.id] > 0) {
                msg += `â–ªï¸ ${cart[item.id]}x ${item.name} (${item.price * cart[item.id]} Ø±ÙŠØ§Ù„)\n`;
                total += cart[item.id] * item.price;
            }
        });

        msg += `------------------------\n`;
        msg += `ğŸ’µ Ø§Ù„Ø·Ø¹Ø§Ù…: ${total} Ø±ÙŠØ§Ù„\n`;
        msg += `ğŸ›µ Ø§Ù„ØªÙˆØµÙŠÙ„: ${deliveryCost > 0 ? deliveryCost + ' Ø±ÙŠØ§Ù„' : '(ÙŠØ­Ø¯Ø¯ Ù„Ø§Ø­Ù‚Ø§Ù‹)'}\n`;
        msg += `ğŸ’° *Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ:* ${total + deliveryCost} Ø±ÙŠØ§Ù„\n`;
        
        if(notes) msg += `ğŸ“ Ù…Ù„Ø§Ø­Ø¸Ø§Øª: ${notes}\n`;
        
        if(userLocation) {
            msg += `ğŸ“ *Ø§Ù„Ù…ÙˆÙ‚Ø¹:* https://maps.google.com/?q=${userLocation.latitude},${userLocation.longitude}`;
        }

        if(confirm("Ø³ÙŠØªÙ… Ù†Ù‚Ù„Ùƒ Ù„Ù„ÙˆØ§ØªØ³Ø§Ø¨ Ù„Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨. ØªØ£ÙƒÙŠØ¯ØŸ")) {
            localStorage.removeItem('bik_cart');
            window.open(`https://wa.me/${WHATSAPP_NUMBER}?text=${encodeURIComponent(msg)}`, '_blank');
            location.reload(); 
        }
    };

    initializeTheme(); // ğŸ’¡ ØªØ´ØºÙŠÙ„ Ø¯Ø§Ù„Ø© Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ø¯Ø§ÙƒÙ†
    checkStoreStatus();
    loadCart();
    renderMenu();
</script>

</body>
</html>
