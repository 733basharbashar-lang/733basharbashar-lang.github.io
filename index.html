<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ğŸ‘‘ ÙÙ„Ø§ÙÙ„ ÙˆØ·Ø¹Ù…ÙŠØ© Ø§Ù„Ø¨ÙŠÙƒ - Ø§Ù„Ø­ÙˆØ¨Ø§Ù†</title>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        /* --- Ø§Ù„ØªØµÙ…ÙŠÙ… (CSS) --- */
        :root {
            --primary: #D32F2F; --secondary: #FFC107; --bg: #F9FAFB;
            --card-bg: #FFFFFF; --text: #1F2937; --text-light: #6B7280;
            --green: #10B981; --kurimi: #00695c; --shadow-color: rgba(0,0,0,0.08);
            --border-color: #E5E7EB;
        }
        body.dark-mode {
            --bg: #111827; --card-bg: #1F2937; --text: #F3F4F6;
            --text-light: #9CA3AF; --shadow-color: rgba(0,0,0,0.3); --border-color: #374151;
        }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body {
            font-family: 'Tajawal', sans-serif; background-color: var(--bg);
            margin: 0; padding-bottom: 180px; color: var(--text); transition: background-color 0.3s, color 0.3s;
        }
        header {
            background: var(--card-bg); padding: 20px 15px; text-align: center;
            box-shadow: 0 4px 20px var(--shadow-color); position: sticky; top: 0; z-index: 1000;
            border-bottom: 4px solid var(--primary); border-radius: 0 0 20px 20px;
        }
        .logo-area img {
            width: 120px; height: 120px; border-radius: 50%; border: 4px solid var(--secondary);
            box-shadow: 0 8px 20px rgba(0,0,0,0.15); object-fit: cover; background: white;
        }
        h1 { margin: 15px 0 5px; font-size: 1.5rem; color: var(--primary); font-weight: 900; letter-spacing: -0.5px; }
        .location-badge { font-size: 0.9rem; color: var(--text-light); margin-bottom: 10px; display: flex; justify-content: center; align-items: center; gap: 5px; }
        .status-badge { padding: 6px 18px; border-radius: 30px; font-size: 0.9rem; font-weight: bold; display: inline-block; box-shadow: 0 2px 10px rgba(0,0,0,0.05); }
        .open { background: #DCFCE7; color: #166534; }
        .closed { background: #FEE2E2; color: #991B1B; }
        #theme-toggle {
            position: absolute; top: 20px; left: 20px; width: 45px; height: 45px;
            background: var(--bg); border: 2px solid var(--border-color);
            border-radius: 50%; cursor: pointer; display: flex; align-items: center; justify-content: center;
            font-size: 22px; color: var(--text); transition: 0.3s; box-shadow: 0 2px 10px var(--shadow-color);
        }
        .nav-scroller { display: flex; gap: 12px; overflow-x: auto; padding: 15px; scrollbar-width: none; background: var(--bg); }
        .nav-item {
            background: var(--card-bg); border: 1px solid var(--border-color); padding: 12px 25px; border-radius: 12px;
            white-space: nowrap; cursor: pointer; transition: 0.3s; font-weight: 700; color: var(--text); font-size: 1rem;
            box-shadow: 0 2px 5px var(--shadow-color);
        }
        .nav-item.active { background: var(--primary); color: white; border-color: var(--primary); transform: translateY(-2px); box-shadow: 0 5px 15px rgba(211, 47, 47, 0.3); }
        .menu-grid { padding: 10px 15px; display: grid; gap: 20px; }
        .menu-item {
            background: var(--card-bg); border-radius: 16px; padding: 12px; display: flex; align-items: center;
            box-shadow: 0 4px 15px var(--shadow-color); transition: transform 0.2s; border: 1px solid var(--border-color);
        }
        .menu-item:active { transform: scale(0.98); }
        .menu-item img {
            width: 100px; height: 100px; border-radius: 12px; object-fit: cover; margin-left: 15px; background-color: #f0f0f0;
        }
        .item-info { flex: 1; }
        .item-info h3 { margin: 0 0 6px; font-size: 1.1rem; color: var(--text); font-weight: 800; }
        .item-desc { font-size: 0.8rem; color: var(--text-light); margin-bottom: 8px; line-height: 1.4; }
        .price { color: var(--primary); font-weight: 900; font-size: 1.2rem; }
        .controls { display: flex; align-items: center; background: var(--bg); border-radius: 25px; padding: 4px; border: 1px solid var(--border-color); }
        .btn-qty { width: 32px; height: 32px; border: none; background: var(--card-bg); border-radius: 50%; font-size: 1.2rem; color: var(--primary); box-shadow: 0 2px 5px rgba(0,0,0,0.1); cursor: pointer; display: flex; align-items: center; justify-content: center; }
        .qty-val { width: 35px; text-align: center; font-weight: bold; color: var(--text); }
        .cart-bar { position: fixed; bottom: 0; left: 0; right: 0; background: var(--card-bg); padding: 20px; border-radius: 25px 25px 0 0; box-shadow: 0 -10px 30px rgba(0,0,0,0.1); z-index: 2000; transition: background-color 0.3s; }
        .delivery-panel { background: var(--bg); border: 1px solid var(--border-color); padding: 12px; border-radius: 12px; margin-bottom: 15px; font-size: 0.9rem; display: flex; justify-content: space-between; align-items: center; color: var(--text); }
        .delivery-btn { background: var(--text); color: var(--bg); border: none; padding: 8px 16px; border-radius: 8px; cursor: pointer; font-size: 0.85rem; font-weight: bold; }
        .total-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; font-weight: 900; font-size: 1.3rem; color: var(--text); }
        .action-btn { width: 100%; padding: 16px; border: none; border-radius: 16px; background: #10B981; color: white; font-size: 1.2rem; font-weight: 900; display: flex; justify-content: center; align-items: center; gap: 10px; cursor: pointer; transition: 0.3s; box-shadow: 0 5px 20px rgba(16, 185, 129, 0.4); }
        .action-btn:disabled { background: #9CA3AF; box-shadow: none; }
        .modal-box { background: var(--card-bg); padding: 25px; border-radius: 20px; width: 90%; max-width: 400px; }
        .input-field { width: 100%; padding: 12px; border-radius: 10px; margin-top: 5px; outline: none; font-size: 1rem; background: var(--bg); color: var(--text); border: 1px solid var(--border-color); }
        .pay-opt { flex: 1; padding: 15px; text-align: center; border-radius: 12px; cursor: pointer; border: 2px solid var(--border-color); font-weight: bold; color: var(--text); transition: 0.2s; }
        .pay-opt.selected { border-color: var(--kurimi); background: rgba(0, 105, 92, 0.05); color: var(--kurimi); }
        .nav-scroller::-webkit-scrollbar { display: none; }
        .nav-scroller { -ms-overflow-style: none; }
    </style>
</head>
<body>

    <header>
        <button id="theme-toggle">â˜€ï¸</button>
        <div class="logo-area">
            <!-- 
                ğŸ›‘ Ù…ÙƒØ§Ù† Ø§Ù„Ø´Ø¹Ø§Ø±:
                ÙˆØ¶Ø¹Øª Ù„Ùƒ Ù‡Ù†Ø§ ØµÙˆØ±Ø© "ØªØ§Ø¬" Ù…Ø¤Ù‚ØªØ©.
                Ø¥Ø°Ø§ Ø­ØµÙ„Øª Ø¹Ù„Ù‰ Ø§Ù„Ø±Ø§Ø¨Ø· Ø§Ù„Ø°ÙŠ ÙŠØ¨Ø¯Ø£ Ø¨Ù€ pbs.twimg Ù„ØµÙˆØ±Ø© Ø§Ù„Ø´Ø¹Ø§Ø±ØŒ Ø¶Ø¹Ù‡ Ù‡Ù†Ø§ Ù…ÙƒØ§Ù† Ø§Ù„Ø±Ø§Ø¨Ø· Ø§Ù„Ù…ÙˆØ¬ÙˆØ¯.
            -->
            <img src="https://cdn-icons-png.flaticon.com/512/1046/1046751.png" alt="Ø´Ø¹Ø§Ø± Ø§Ù„Ø¨ÙŠÙƒ">
        </div>
        <h1>ÙÙ„Ø§ÙÙ„ ÙˆØ·Ø¹Ù…ÙŠØ© Ø§Ù„Ø¨ÙŠÙƒ ğŸ‘‘</h1>
        <div class="location-badge">ğŸ“ ØªØ¹Ø² - Ø§Ù„Ø­ÙˆØ¨Ø§Ù†</div>
        <div id="store-status" class="status-badge open">ğŸŸ¢ Ù…ÙØªÙˆØ­ - Ù†Ø³ØªÙ‚Ø¨Ù„ Ø§Ù„Ø·Ù„Ø¨Ø§Øª</div>
    </header>

    <div class="nav-scroller">
        <button class="nav-item active" onclick="filter('all', this)">Ø§Ù„ÙƒÙ„</button>
        <button class="nav-item" onclick="filter('Ø³Ù†Ø¯ÙˆØªØ´Ø§Øª', this)">Ø³Ù†Ø¯ÙˆØªØ´Ø§Øª ğŸŒ¯</button>
        <button class="nav-item" onclick="filter('ÙˆØ¬Ø¨Ø§Øª', this)">ÙˆØ¬Ø¨Ø§Øª ğŸŸ</button>
        <button class="nav-item" onclick="filter('Ù…Ø´Ø±ÙˆØ¨Ø§Øª', this)">Ù…Ø´Ø±ÙˆØ¨Ø§Øª ğŸ¥¤</button>
    </div>

    <div id="menu-list" class="menu-grid"></div>

    <div class="cart-bar">
        <div class="delivery-panel" id="delivery-panel">
            <span id="delivery-text">ğŸ“ Ø­Ø¯Ø¯ Ù…ÙˆÙ‚Ø¹Ùƒ (Ø§Ù„ØªÙˆØµÙŠÙ„ Ù„Ù„Ø­ÙˆØ¨Ø§Ù† ÙÙ‚Ø·)</span>
            <button class="delivery-btn" onclick="calculateDelivery()">Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø³Ø§ÙØ©</button>
        </div>
        <div class="total-row">
            <span>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ:</span>
            <span id="grand-total" style="color:var(--primary)">0 Ø±ÙŠØ§Ù„</span>
        </div>
        <button id="main-btn" class="action-btn" onclick="openCustomerModal()" disabled>Ø³Ù„Ø© ÙØ§Ø±ØºØ© ğŸ›’</button>
    </div>

    <div id="customer-modal" class="modal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); z-index:3000; justify-content:center; align-items:center;">
        <div class="modal-box">
            <h3 style="margin-top:0; color:var(--primary); text-align:center;">Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ù„Ø¨ ğŸ“</h3>
            
            <div style="margin-bottom:15px;">
                <label style="font-weight:bold; font-size:0.9rem; color:var(--text);">Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹:</label>
                <div style="display:flex; gap:10px; margin-top:5px;">
                    <div class="pay-opt selected" onclick="selectPayment('ÙƒØ§Ø´', this)">
                        <span style="font-size:1.2rem;">ğŸ’µ</span><br>ÙƒØ§Ø´
                    </div>
                    <div class="pay-opt" onclick="selectPayment('Ø­Ø§Ø³Ø¨ (ÙƒØ±ÙŠÙ…ÙŠ)', this)">
                        <span style="font-size:1.2rem; color:#00695c;">ğŸ¦</span><br>Ø­Ø§Ø³Ø¨
                    </div>
                </div>
            </div>

            <div style="margin-bottom:10px;">
                <label style="font-weight:bold; font-size:0.9rem; color:var(--text);">Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ±ÙŠÙ…:</label>
                <input type="text" id="cust-name" class="input-field" placeholder="Ø§Ù„Ø§Ø³Ù…..">
            </div>
            
            <div style="margin-bottom:10px;">
                <label style="font-weight:bold; font-size:0.9rem; color:var(--text);">Ø±Ù‚Ù… Ø§Ù„Ø¬ÙˆØ§Ù„ (ÙˆØ§ØªØ³Ø§Ø¨):</label>
                <input type="tel" id="cust-phone" class="input-field" placeholder="7xxxxxxxx" maxlength="9">
            </div>
            
            <div style="margin-bottom:20px;">
                <label style="font-weight:bold; font-size:0.9rem; color:var(--text);">Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ©:</label>
                <input type="text" id="cust-notes" class="input-field" placeholder="Ø¨Ø¯ÙˆÙ† Ø´Ø·Ø©ØŒ ÙƒØ«Ø± Ø·Ø­ÙŠÙ†Ø©...">
            </div>

            <button class="action-btn" onclick="sendToWhatsapp()">ØªØ£ÙƒÙŠØ¯ ÙˆØ¥Ø±Ø³Ø§Ù„ ğŸš€</button>
            <button onclick="document.getElementById('customer-modal').style.display='none'" style="width:100%; padding:10px; margin-top:10px; background:transparent; border:none; color:var(--text-light); font-weight:bold; cursor:pointer;">Ø¥Ù„ØºØ§Ø¡</button>
        </div>
    </div>

<script>
    // ==========================================
    // ğŸ“‹ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø·Ø¹Ø§Ù… (Ø§Ù„Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„Ø£ØµÙ„ÙŠØ© ÙƒÙ…Ø§ Ø·Ù„Ø¨Øª)
    // ==========================================
    
    const menu = [
        // --- Ø§Ù„Ø³Ù†Ø¯ÙˆØªØ´Ø§Øª ---
        { 
            id: 1, 
            name: "Ø³Ø§Ù†Ø¯ÙˆÙŠØªØ´ ÙÙ„Ø§ÙÙ„ (Ø·Ø¹Ù…ÙŠØ©)", // Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø£ØµÙ„ÙŠ
            price: 100,
            cat: "Ø³Ù†Ø¯ÙˆØªØ´Ø§Øª", 
            desc: "Ø·Ø¹Ù…ÙŠØ© Ù…Ù‚Ø±Ù…Ø´Ø© Ù…Ø¹ Ø³Ù„Ø·Ø©", 
            // âœ… Ø§Ù„Ø±Ø§Ø¨Ø· Ø´ØºØ§Ù„ (Ø£Ù†Øª Ø£Ø­Ø¶Ø±ØªÙ‡)
            img: "https://pbs.twimg.com/media/G8PkXGja4AIRMH_?format=jpg&name=medium" 
        },
        { 
            id: 2, 
            name: "Ø³Ø§Ù†Ø¯ÙˆÙŠØªØ´ ÙÙ„Ø§ÙÙ„ Ù…Ø¹ Ø§Ù„Ø¨ÙŠØ¶", // Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø£ØµÙ„ÙŠ
            price: 150,
            cat: "Ø³Ù†Ø¯ÙˆØªØ´Ø§Øª", 
            desc: "ÙÙ„Ø§ÙÙ„ Ù…Ù…ÙŠØ²Ø© Ù…Ø¹ Ø§Ù„Ø¨ÙŠØ¶ Ø§Ù„Ù…Ø³Ù„ÙˆÙ‚",
            // ØµÙˆØ±Ø© Ø¨Ø¯ÙŠÙ„Ø© Ù…Ø¤Ù‚ØªØ© (Ù„Ø£Ù† Ø±Ø§Ø¨Ø· x.com Ù„Ø§ ÙŠØ¹Ù…Ù„)
            img: "https://images.unsplash.com/photo-1626082927389-6cd097cdc6ec?auto=format&fit=crop&w=600&q=80"
        },
        
        // --- Ø§Ù„ÙˆØ¬Ø¨Ø§Øª ---
        { 
            id: 3, 
            name: "ÙˆØ¬Ø¨Ø© Ù…Ø§ÙƒØ³ Ø§Ù„Ù…Ù„ÙƒÙŠ (ÙÙ„Ø§ÙÙ„ ÙˆØ¨Ø·Ø§Ø·Ø³)", // Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø£ØµÙ„ÙŠ
            price: 500,
            cat: "ÙˆØ¬Ø¨Ø§Øª", 
            desc: "ØªØ´ÙƒÙŠÙ„Ø© Ù…Ø´Ø¨Ø¹Ø© Ù…Ù† Ø§Ù„ÙÙ„Ø§ÙÙ„ ÙˆØ§Ù„Ø¨Ø·Ø§Ø·Ø³",
            // ØµÙˆØ±Ø© Ø¨Ø¯ÙŠÙ„Ø© Ù…Ø¤Ù‚ØªØ©
            img: "https://images.unsplash.com/photo-1547496502-ffa22b33b274?auto=format&fit=crop&w=600&q=80"
        },
        { 
            id: 4, 
            name: "ØµØ­Ù† Ø¨Ø·Ø§Ø·Ø³ Ù…Ù‚Ø±Ù…Ø´Ø©", // Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø£ØµÙ„ÙŠ
            price: 400,
            cat: "ÙˆØ¬Ø¨Ø§Øª", 
            desc: "Ø¨Ø·Ø§Ø·Ø³ Ù…Ù‚Ù„ÙŠØ© Ø°Ù‡Ø¨ÙŠØ© ÙˆÙ…Ù‚Ø±Ù…Ø´Ø©",
            // ØµÙˆØ±Ø© Ø¨Ø¯ÙŠÙ„Ø© Ù…Ø¤Ù‚ØªØ©
            img: "https://images.unsplash.com/photo-1630384060421-a4332e264a63?auto=format&fit=crop&w=600&q=80"
        },

        // --- Ø§Ù„Ù…Ø´Ø±ÙˆØ¨Ø§Øª ---
        { 
            id: 5, 
            name: "Ø³ÙÙ† Ø£Ø¨", // Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø£ØµÙ„ÙŠ
            price: 200,
            cat: "Ù…Ø´Ø±ÙˆØ¨Ø§Øª", 
            desc: "Ù…Ø´Ø±ÙˆØ¨ ØºØ§Ø²ÙŠ Ù…Ù†Ø¹Ø´",
            // ØµÙˆØ±Ø© Ø¨Ø¯ÙŠÙ„Ø© Ù…Ø¤Ù‚ØªØ©
            img: "https://images.unsplash.com/photo-1622483767028-3f66f32aef97?auto=format&fit=crop&w=600&q=80"
        },
        { 
            id: 6, 
            name: "Ù…Ø´Ø±ÙˆØ¨ ÙƒÙˆÙƒÙˆÙ„Ø§ Ù‚ÙˆÙ‡ Ø§Ø³Ø¯ ÙŠÙ†Ø¹Ø´ Ø§ÙˆÙ‚Ø§ØªÙƒ", // âœ… Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø¬Ø¯ÙŠØ¯ Ø§Ù„Ø°ÙŠ Ø·Ù„Ø¨ØªÙ‡
            price: 100,
            cat: "Ù…Ø´Ø±ÙˆØ¨Ø§Øª", 
            desc: "Ù…Ø´Ø±ÙˆØ¨ Ø·Ø§Ù‚Ø© (Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù†ÙƒÙ‡Ø§Øª)",
            // âœ… Ø§Ù„Ø±Ø§Ø¨Ø· Ø´ØºØ§Ù„ (Ø£Ù†Øª Ø£Ø­Ø¶Ø±ØªÙ‡)
            img: "https://pbs.twimg.com/media/G8S2ocOaYAE___8?format=jpg&name=900x900"
        },
    ];

    // ==========================================
    // âš™ï¸ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù…
    // ==========================================
    
    const HAWBAN_LAT = 13.6180; 
    const HAWBAN_LNG = 44.0680; 
    const MAX_DELIVERY_RANGE = 7.0; 
    const PRICE_PER_KM = 300; 
    const MIN_DELIVERY = 500; 
    const WHATSAPP_NUMBER = "967733971941";

    let cart = {};
    let deliveryCost = 0;
    let userLocation = null;
    let selectedPayment = 'ÙƒØ§Ø´';

    function initializeTheme() {
        const savedTheme = localStorage.getItem('theme');
        if (savedTheme === 'dark') {
            document.body.classList.add('dark-mode');
            document.getElementById('theme-toggle').textContent = 'ğŸŒ™'; 
        } else {
            document.getElementById('theme-toggle').textContent = 'â˜€ï¸'; 
        }
    }

    document.getElementById('theme-toggle').addEventListener('click', () => {
        document.body.classList.toggle('dark-mode');
        const isDarkMode = document.body.classList.contains('dark-mode');
        localStorage.setItem('theme', isDarkMode ? 'dark' : 'light');
        document.getElementById('theme-toggle').textContent = isDarkMode ? 'ğŸŒ™' : 'â˜€ï¸';
    });

    function checkStoreStatus() {
        const hour = new Date().getHours();
        const statusDiv = document.getElementById('store-status');
        const mainBtn = document.getElementById('main-btn'); 
        
        if (hour >= 2 && hour < 7) { 
            statusDiv.className = 'status-badge closed';
            statusDiv.innerHTML = 'ğŸ”´ Ù…ØºÙ„Ù‚ Ø­Ø§Ù„ÙŠØ§Ù‹ (Ù†Ø¹ÙˆØ¯ 7 ØµØ¨Ø§Ø­Ø§Ù‹)'; 
            mainBtn.disabled = true; 
            mainBtn.innerText = "Ø§Ù„Ù…Ø·Ø¹Ù… Ù…ØºÙ„Ù‚ ğŸ”’"; 
            mainBtn.onclick = null; 
        } else {
            statusDiv.className = 'status-badge open';
            statusDiv.innerHTML = 'ğŸŸ¢ Ù…ÙØªÙˆØ­ - Ù†Ø³ØªÙ‚Ø¨Ù„ Ø§Ù„Ø·Ù„Ø¨Ø§Øª';
            mainBtn.onclick = openCustomerModal; 
        }
    }

    function loadCart() {
        const saved = localStorage.getItem('bik_cart');
        if (saved) { cart = JSON.parse(saved); updateTotal(); }
    }

    function renderMenu(category = 'all') {
        const container = document.getElementById('menu-list');
        container.innerHTML = '';
        const fallbackImg = "https://cdn-icons-png.flaticon.com/512/706/706164.png";

        menu.forEach(item => {
            if (category === 'all' || item.cat === category) {
                const qty = cart[item.id] || 0;
                container.innerHTML += `
                <div class="menu-item">
                    <img src="${item.img}" onerror="this.src='${fallbackImg}'" onclick="updateQty(${item.id}, 1)">
                    <div class="item-info">
                        <h3>${item.name}</h3>
                        <div class="item-desc">${item.desc || ''}</div>
                        <div class="price">${item.price} Ø±ÙŠØ§Ù„</div>
                    </div>
                    <div class="controls">
                        <button class="btn-qty" onclick="updateQty(${item.id}, -1)">-</button>
                        <span class="qty-val">${qty}</span>
                        <button class="btn-qty" onclick="updateQty(${item.id}, 1)">+</button>
                    </div>
                </div>`;
            }
        });
    }

    window.updateQty = (id, change) => {
        if(navigator.vibrate) navigator.vibrate(40);
        if (!cart[id]) cart[id] = 0;
        cart[id] += change;
        if (cart[id] <= 0) delete cart[id];
        localStorage.setItem('bik_cart', JSON.stringify(cart));
        const currentCat = document.querySelector('.nav-item.active').innerText.split(' ')[0];
        renderMenu(currentCat === 'Ø§Ù„ÙƒÙ„' ? 'all' : currentCat);
        updateTotal();
    };

    function getDistance(lat1, lon1, lat2, lon2) {
        const R = 6371; 
        const dLat = (lat2 - lat1) * Math.PI / 180;
        const dLon = (lon2 - lon1) * Math.PI / 180;
        const a = Math.sin(dLat/2) * Math.sin(dLat/2) +
                  Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) * Math.sin(dLon/2) * Math.sin(dLon/2);
        const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
        return R * c; 
    }

    window.calculateDelivery = () => {
        const btn = document.querySelector('.delivery-btn');
        const txt = document.getElementById('delivery-text');
        btn.innerText = "Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø­Ø³Ø§Ø¨...";
        
        if (!navigator.geolocation) return alert("ÙŠØ±Ø¬Ù‰ ØªÙØ¹ÙŠÙ„ Ø§Ù„Ù…ÙˆÙ‚Ø¹ (GPS) Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø³Ø§ÙØ©");

        navigator.geolocation.getCurrentPosition(
            (pos) => {
                userLocation = pos.coords;
                const dist = getDistance(HAWBAN_LAT, HAWBAN_LNG, userLocation.latitude, userLocation.longitude);
                
                if (dist > MAX_DELIVERY_RANGE) {
                    txt.innerHTML = `âŒ Ø®Ø§Ø±Ø¬ Ù†Ø·Ø§Ù‚ Ø§Ù„ØªÙˆØµÙŠÙ„ (${dist.toFixed(1)} ÙƒÙ…)`;
                    txt.style.color = "red";
                    deliveryCost = 0;
                    alert("Ø§Ù„Ù…Ø¹Ø°Ø±Ø©ØŒ Ù…ÙˆÙ‚Ø¹Ùƒ Ø¨Ø¹ÙŠØ¯ Ù‚Ù„ÙŠÙ„Ø§Ù‹ Ø¹Ù† Ø§Ù„Ø­ÙˆØ¨Ø§Ù†.");
                } else {
                    let cost = Math.ceil(dist * PRICE_PER_KM);
                    if(cost < MIN_DELIVERY) cost = MIN_DELIVERY;
                    cost = Math.ceil(cost / 50) * 50; 
                    deliveryCost = cost;
                    txt.innerHTML = `âœ… Ø§Ù„Ù…Ø³Ø§ÙØ©: ${dist.toFixed(1)} ÙƒÙ… | Ø§Ù„ØªÙˆØµÙŠÙ„: ${cost} Ø±ÙŠØ§Ù„`;
                    txt.style.color = "#00695c";
                    btn.style.display = 'none'; 
                    document.getElementById('delivery-panel').style.background = "#e0f2f1";
                }
                updateTotal();
            },
            (err) => {
                btn.innerText = "Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø³Ø§ÙØ©";
                alert("ÙŠØ¬Ø¨ Ø§Ù„Ø³Ù…Ø§Ø­ Ø¨ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ù„Ø­Ø³Ø§Ø¨ Ø³Ø¹Ø± Ø§Ù„ØªÙˆØµÙŠÙ„.");
            },
            { enableHighAccuracy: true }
        );
    };

    function updateTotal() {
        let foodTotal = 0;
        let count = 0;
        menu.forEach(item => {
            if(cart[item.id]) {
                foodTotal += cart[item.id] * item.price;
                count += cart[item.id];
            }
        });
        const grandTotal = foodTotal + deliveryCost;
        document.getElementById('grand-total').innerText = `${grandTotal} Ø±ÙŠØ§Ù„`;
        const btn = document.getElementById('main-btn');
        
        if(count > 0) {
            btn.disabled = false;
            btn.innerHTML = `Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ø·Ù„Ø¨ (${grandTotal} Ø±ÙŠØ§Ù„)`;
        } else {
            btn.disabled = true;
            btn.innerHTML = `Ø³Ù„Ø© ÙØ§Ø±ØºØ© ğŸ›’`;
        }
    }

    window.selectPayment = (type, elem) => {
        selectedPayment = type;
        document.querySelectorAll('.pay-opt').forEach(el => el.classList.remove('selected'));
        elem.classList.add('selected');
    }

    window.openCustomerModal = () => {
        const hour = new Date().getHours();
        if (hour >= 2 && hour < 7) return alert("Ø§Ù„Ù…Ø·Ø¹Ù… Ù…ØºÙ„Ù‚ Ø§Ù„Ø¢Ù†"); 
        
        if(!userLocation && confirm("Ù„Ù… ÙŠØªÙ… ØªØ­Ø¯ÙŠØ¯ Ù…ÙˆÙ‚Ø¹ Ø§Ù„ØªÙˆØµÙŠÙ„. Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø©ØŸ")) {
             document.getElementById('customer-modal').style.display = 'flex';
        } else if (userLocation) {
            document.getElementById('customer-modal').style.display = 'flex';
        }
    }

    window.sendToWhatsapp = () => {
        const name = document.getElementById('cust-name').value;
        const phone = document.getElementById('cust-phone').value;
        const notes = document.getElementById('cust-notes').value;

        if(!name) return alert("Ù„Ø·ÙØ§Ù‹ Ø§ÙƒØªØ¨ Ø§Ø³Ù…Ùƒ");
        if(!phone || phone.length < 9) return alert("Ø±Ù‚Ù… Ø§Ù„Ø¬ÙˆØ§Ù„ Ù…Ø·Ù„ÙˆØ¨");

        let msg = `*ğŸ‘‹ Ø·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯ - ÙÙ„Ø§ÙÙ„ Ø§Ù„Ø¨ÙŠÙƒ (Ø§Ù„Ø­ÙˆØ¨Ø§Ù†)*\n`;
        msg += `ğŸ‘¤ *Ø§Ù„Ø§Ø³Ù…:* ${name}\nğŸ“± *Ø§Ù„Ø¬ÙˆØ§Ù„:* ${phone}\n`;
        msg += `ğŸ’³ *Ø§Ù„Ø¯ÙØ¹:* ${selectedPayment}\n`;
        msg += `------------------------\n`;
        
        let total = 0;
        menu.forEach(item => {
            if(cart[item.id] > 0) {
                msg += `â–ªï¸ ${cart[item.id]}x ${item.name} (${item.price * cart[item.id]} Ø±ÙŠØ§Ù„)\n`;
                total += cart[item.id] * item.price;
            }
        });

        msg += `------------------------\n`;
        msg += `ğŸ¥˜ Ø§Ù„Ø·Ø¹Ø§Ù…: ${total} Ø±ÙŠØ§Ù„\n`;
        msg += `ğŸ›µ Ø§Ù„ØªÙˆØµÙŠÙ„: ${deliveryCost > 0 ? deliveryCost + ' Ø±ÙŠØ§Ù„' : '(ÙŠØ­Ø¯Ø¯ Ù„Ø§Ø­Ù‚Ø§Ù‹)'}\n`;
        msg += `ğŸ’° *Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ:* ${total + deliveryCost} Ø±ÙŠØ§Ù„\n`;
        
        if(notes) msg += `ğŸ“ *Ù…Ù„Ø§Ø­Ø¸Ø§Øª:* ${notes}\n`;
        
        if(userLocation) {
            msg += `ğŸ“ *Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø²Ø¨ÙˆÙ†:* https://maps.google.com/?q=${userLocation.latitude},${userLocation.longitude}`;
        }

        localStorage.removeItem('bik_cart');
        window.open(`https://wa.me/${WHATSAPP_NUMBER}?text=${encodeURIComponent(msg)}`, '_blank');
        location.reload(); 
    };

    initializeTheme();
    checkStoreStatus();
    loadCart();
    renderMenu();
</script>

</body>
</html>
